<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel de Or√ßamentos ‚Äî OAB Santana de Parna√≠ba</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --ink:#0f1419;--cream:#faf8f3;--cream-dark:#f0ece1;
  --gold:#b8922a;--gold-light:#d4a843;--gold-pale:#f5ead4;
  --teal:#1a6b6b;--teal-light:#e8f4f4;
  --rose:#8b2a2a;--rose-light:#f8eded;
  --slate:#4a5568;--border:#d4c9b0;
  --shadow:0 4px 24px rgba(15,20,25,0.08);
  --shadow-lg:0 12px 48px rgba(15,20,25,0.15);
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'DM Sans',sans-serif;background:var(--cream);color:var(--ink);min-height:100vh;}

.site-header{background:var(--ink);color:white;padding:0 40px;display:flex;align-items:stretch;min-height:80px;position:sticky;top:0;z-index:100;box-shadow:0 2px 20px rgba(0,0,0,0.4);}
.header-brand{display:flex;align-items:center;gap:20px;padding:16px 0;border-right:1px solid rgba(255,255,255,0.1);padding-right:30px;margin-right:30px;}
.oab-seal{width:48px;height:48px;border:2px solid var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-size:18px;font-weight:900;color:var(--gold);flex-shrink:0;}
.brand-text h1{font-family:'Playfair Display',serif;font-size:15px;font-weight:700;letter-spacing:0.05em;color:white;}
.brand-text p{font-size:10px;color:rgba(255,255,255,0.5);text-transform:uppercase;letter-spacing:0.15em;margin-top:2px;}
.header-nav{display:flex;align-items:center;gap:4px;}
.nav-tab{padding:8px 18px;border-radius:6px;cursor:pointer;font-size:13px;font-weight:500;color:rgba(255,255,255,0.6);transition:all 0.2s;border:none;background:none;white-space:nowrap;}
.nav-tab:hover{color:white;background:rgba(255,255,255,0.08);}
.nav-tab.active{color:var(--gold);background:rgba(184,146,42,0.15);}
.header-date{margin-left:auto;display:flex;align-items:center;font-size:12px;color:rgba(255,255,255,0.4);font-family:'DM Mono',monospace;}

.sync-bar{display:flex;align-items:center;justify-content:center;gap:8px;padding:7px;font-size:12px;font-weight:500;background:#1a2744;color:#7aa7ff;}
.sync-bar.ok{background:#0d2b1a;color:#4ade80;}
.sync-bar.error{background:#2b0d0d;color:#f87171;}
.sync-dot{width:8px;height:8px;border-radius:50%;background:currentColor;animation:pulse 1.5s infinite;}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}

.dashboard-bar{background:white;border-bottom:1px solid var(--border);padding:20px 40px;display:flex;gap:24px;flex-wrap:wrap;}
.stat-card{display:flex;align-items:center;gap:14px;padding:12px 20px;border-radius:8px;background:var(--cream);border:1px solid var(--border);min-width:150px;}
.stat-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.stat-icon.gold{background:var(--gold-pale);}
.stat-icon.teal{background:var(--teal-light);}
.stat-icon.rose{background:var(--rose-light);}
.stat-info .num{font-family:'Playfair Display',serif;font-size:22px;font-weight:700;line-height:1;}
.stat-info .label{font-size:11px;color:var(--slate);text-transform:uppercase;letter-spacing:0.08em;margin-top:2px;}

.main{padding:40px;}
.panel{display:none;}
.panel.active{display:block;}
.panel-title{font-family:'Playfair Display',serif;font-size:28px;font-weight:700;margin-bottom:6px;}
.panel-sub{font-size:13px;color:var(--slate);margin-bottom:30px;}

.form-card{background:white;border:1px solid var(--border);border-radius:12px;padding:32px;margin-bottom:30px;box-shadow:var(--shadow);}
.form-card h3{font-family:'Playfair Display',serif;font-size:16px;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid var(--border);}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;}
.form-group{display:flex;flex-direction:column;gap:6px;}
.form-group.full{grid-column:1/-1;}
label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.1em;color:var(--slate);}
label .req{color:var(--rose);}
input[type="text"],input[type="number"],input[type="date"],select,textarea{width:100%;padding:11px 14px;border:1px solid var(--border);border-radius:6px;font-family:'DM Sans',sans-serif;font-size:14px;color:var(--ink);background:var(--cream);transition:border-color 0.2s,box-shadow 0.2s;outline:none;}
input:focus,select:focus,textarea:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(184,146,42,0.12);background:white;}
textarea{resize:vertical;min-height:80px;}

.badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:100px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.06em;}
.badge-pending{background:#fff7e6;color:#b45309;border:1px solid #fcd34d;}
.badge-approved{background:#e6fff0;color:#065f46;border:1px solid #6ee7b7;}
.badge-rejected{background:#fff0f0;color:#991b1b;border:1px solid #fca5a5;}
.badge-adjust{background:#eff6ff;color:#1d4ed8;border:1px solid #93c5fd;}
.badge-done{background:#f5f3ff;color:#5b21b6;border:1px solid #c4b5fd;}

.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:7px;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;border:none;transition:all 0.2s;text-decoration:none;}
.btn-primary{background:var(--gold);color:white;}
.btn-primary:hover{background:var(--gold-light);transform:translateY(-1px);box-shadow:0 4px 12px rgba(184,146,42,0.3);}
.btn-secondary{background:white;color:var(--ink);border:1px solid var(--border);}
.btn-secondary:hover{border-color:var(--gold);color:var(--gold);}
.btn-danger{background:white;color:var(--rose);border:1px solid var(--border);}
.btn-danger:hover{background:var(--rose-light);border-color:var(--rose);}
.btn-teal{background:var(--teal);color:white;}
.btn-teal:hover{background:#155a5a;transform:translateY(-1px);}
.btn-sm{padding:6px 12px;font-size:12px;}
.btn-row{display:flex;gap:10px;margin-top:24px;flex-wrap:wrap;}

.table-wrap{background:white;border:1px solid var(--border);border-radius:12px;overflow:hidden;box-shadow:var(--shadow);}
.table-toolbar{display:flex;align-items:center;gap:12px;padding:16px 20px;border-bottom:1px solid var(--border);background:var(--cream);flex-wrap:wrap;}
.table-toolbar h3{font-family:'Playfair Display',serif;font-size:15px;margin:0;}
.search-box input{padding:7px 12px;border:1px solid var(--border);border-radius:6px;font-size:13px;width:200px;background:white;}
table{width:100%;border-collapse:collapse;}
th{background:var(--cream-dark);padding:12px 16px;text-align:left;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;color:var(--slate);border-bottom:1px solid var(--border);}
td{padding:13px 16px;font-size:13px;border-bottom:1px solid rgba(212,201,176,0.4);vertical-align:middle;}
tr:last-child td{border-bottom:none;}
tr:hover td{background:var(--cream);}
tr.winner-row td{background:#e6fff0;}
tr.winner-row td:first-child{border-left:3px solid #065f46;}

.suppliers-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-bottom:30px;}
.supplier-card{background:white;border:1px solid var(--border);border-radius:12px;padding:22px;box-shadow:var(--shadow);transition:all 0.2s;}
.supplier-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg);}
.sc-top{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px;}
.supplier-avatar{width:44px;height:44px;border-radius:10px;background:var(--gold-pale);display:flex;align-items:center;justify-content:center;font-family:'Playfair Display',serif;font-size:18px;font-weight:700;color:var(--gold);}
.sc-actions{display:flex;gap:6px;}
.supplier-card h4{font-family:'Playfair Display',serif;font-size:15px;margin-bottom:4px;}
.sc-cat{font-size:11px;color:var(--slate);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:14px;}
.sc-detail{font-size:12px;color:var(--slate);margin-bottom:5px;}
.sc-detail span{color:var(--ink);font-weight:500;}
.stars{color:var(--gold);font-size:14px;letter-spacing:2px;}

.gimba-card{background:white;border:2px solid var(--gold);border-radius:16px;padding:32px;margin-bottom:30px;box-shadow:var(--shadow-lg);}
.gimba-card h3{font-family:'Playfair Display',serif;font-size:18px;margin-bottom:6px;}
.gimba-subtitle{font-size:13px;color:var(--slate);margin-bottom:24px;}
.gimba-meta{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;margin-bottom:24px;padding:20px;background:var(--cream);border-radius:10px;border:1px solid var(--border);}
.gimba-table-wrap{border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:20px;}
.gimba-table-wrap table{width:100%;border-collapse:collapse;}
.gimba-table-wrap th{background:var(--ink);color:white;padding:12px 16px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;}
.gimba-table-wrap td{padding:14px 16px;font-size:13px;border-bottom:1px solid rgba(212,201,176,0.4);vertical-align:middle;background:white;}
.gimba-table-wrap tr:last-child td{border-bottom:none;}

.qty-chefe{background:#fff9e6 !important;border-left:3px solid var(--gold);}
.qty-chefe input{background:white;border:2px solid var(--gold);border-radius:6px;padding:8px 10px;width:90px;font-size:14px;font-weight:700;color:var(--ink);text-align:center;}
.qty-chefe input:focus{box-shadow:0 0 0 3px rgba(184,146,42,0.2);outline:none;}

.estoque-badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:100px;font-size:12px;font-weight:600;}
.estoque-ok{background:#e6fff0;color:#065f46;border:1px solid #6ee7b7;}
.estoque-baixo{background:#fff7e6;color:#b45309;border:1px solid #fcd34d;}
.estoque-zero{background:#fff0f0;color:#991b1b;border:1px solid #fca5a5;}

.add-item-bar{display:grid;grid-template-columns:2fr 1fr 2fr 1fr 80px;gap:8px;padding:16px;background:var(--cream-dark);border-top:2px dashed var(--border);align-items:center;}
.add-item-bar input{padding:9px 12px;font-size:13px;background:white;border:1px solid var(--border);border-radius:6px;}

.status-flow{display:flex;align-items:center;gap:6px;flex-wrap:wrap;padding:16px 24px;background:var(--cream);border-top:1px solid var(--border);}
.status-step{display:flex;align-items:center;gap:6px;padding:6px 14px;border-radius:100px;font-size:12px;font-weight:600;cursor:pointer;border:2px solid transparent;transition:all 0.2s;}
.status-step.active{border-color:var(--gold);background:var(--gold-pale);color:var(--gold);}
.status-step:not(.active){background:var(--cream-dark);color:var(--slate);border-color:var(--border);}
.arrow{color:var(--slate);font-size:14px;}

.filter-row{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
.filter-chip{padding:7px 16px;border-radius:100px;border:1px solid var(--border);background:white;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;color:var(--slate);}
.filter-chip.active{background:var(--gold);border-color:var(--gold);color:white;}
.filter-chip:hover:not(.active){border-color:var(--gold);color:var(--gold);}

.empty-state{text-align:center;padding:60px 20px;color:var(--slate);}
.empty-state .icon{font-size:48px;margin-bottom:16px;opacity:0.4;}
.empty-state h4{font-family:'Playfair Display',serif;font-size:18px;margin-bottom:8px;}
.empty-state p{font-size:13px;}

.toast-container{position:fixed;bottom:30px;right:30px;z-index:9999;display:flex;flex-direction:column;gap:10px;}
.toast{background:var(--ink);color:white;padding:14px 20px;border-radius:10px;font-size:13px;font-weight:500;display:flex;align-items:center;gap:10px;box-shadow:0 8px 24px rgba(0,0,0,0.3);animation:slideIn 0.3s ease;min-width:260px;max-width:400px;}
.toast.success{border-left:4px solid #22c55e;}
.toast.error{border-left:4px solid var(--rose);}
.toast.info{border-left:4px solid var(--gold);}
@keyframes slideIn{from{transform:translateX(100px);opacity:0}to{transform:translateX(0);opacity:1}}

.report-preview{background:white;border-radius:12px;overflow:hidden;box-shadow:var(--shadow-lg);}
.report-preview-header{background:var(--ink);color:white;padding:16px 24px;display:flex;align-items:center;justify-content:space-between;}
.report-body{padding:50px;}
.report-oab-header{text-align:center;padding-bottom:24px;border-bottom:2px solid var(--ink);margin-bottom:30px;}
.report-oab-header h2{font-family:'Playfair Display',serif;font-size:20px;}

@media print{.site-header,.dashboard-bar,.sync-bar,.print-hide{display:none!important;}body{background:white;}.report-body{padding:20px;}}
@media(max-width:768px){.site-header{padding:0 16px;}.main{padding:16px;}.add-item-bar{grid-template-columns:1fr 1fr;}.dashboard-bar{padding:16px;}}
</style>
</head>
<body>

<header class="site-header">
  <div class="header-brand">
    <div class="oab-seal">OAB</div>
    <div class="brand-text">
      <h1>OAB Santana de Parna√≠ba</h1>
      <p>Painel Integrado de Or√ßamentos</p>
    </div>
  </div>
  <nav class="header-nav">
    <button class="nav-tab active" onclick="showPanel('site',this)">üìÑ Or√ß. Sites</button>
    <button class="nav-tab" onclick="showPanel('fornecedores',this)">üè¢ Fornecedores</button>
    <button class="nav-tab" onclick="showPanel('compras',this)">üõí Compras Gimba</button>
  </nav>
  <div class="header-date" id="headerDate"></div>
</header>

<div class="sync-bar" id="syncBar">
  <div class="sync-dot"></div>
  <span id="syncMsg">Conectando ao banco de dados...</span>
</div>

<div class="dashboard-bar">
  <div class="stat-card"><div class="stat-icon gold">üìã</div><div class="stat-info"><div class="num" id="statOrc">0</div><div class="label">Or√ßamentos</div></div></div>
  <div class="stat-card"><div class="stat-icon teal">‚úÖ</div><div class="stat-info"><div class="num" id="statAprov">0</div><div class="label">Aprovados</div></div></div>
  <div class="stat-card"><div class="stat-icon gold">üè¢</div><div class="stat-info"><div class="num" id="statForn">0</div><div class="label">Fornecedores</div></div></div>
  <div class="stat-card"><div class="stat-icon rose">üõí</div><div class="stat-info"><div class="num" id="statListas">0</div><div class="label">Listas Gimba</div></div></div>
</div>

<main class="main">

<div id="panel-site" class="panel active">
  <div class="panel-title">Or√ßamentos para Sites</div>
  <div class="panel-sub">Registre e compare propostas. O sistema aponta automaticamente o menor pre√ßo.</div>
  <div class="form-card">
    <h3>Novo Or√ßamento</h3>
    <div class="form-grid">
      <div class="form-group"><label>N¬∫ do Or√ßamento <span class="req">*</span></label><input type="text" id="s_num" placeholder="ORC-001"></div>
      <div class="form-group"><label>Data <span class="req">*</span></label><input type="date" id="s_data"></div>
      <div class="form-group"><label>Fornecedor <span class="req">*</span></label><input type="text" id="s_fornecedor" placeholder="Nome da empresa"></div>
      <div class="form-group"><label>CNPJ</label><input type="text" id="s_cnpj" placeholder="00.000.000/0000-00"></div>
      <div class="form-group full"><label>Descri√ß√£o do Servi√ßo <span class="req">*</span></label><textarea id="s_descricao" placeholder="Descreva o servi√ßo cotado..."></textarea></div>
      <div class="form-group"><label>Valor Total (R$) <span class="req">*</span></label><input type="number" id="s_valor" placeholder="0.00" step="0.01"></div>
      <div class="form-group"><label>Prazo de Execu√ß√£o</label><input type="text" id="s_prazo" placeholder="Ex: 30 dias"></div>
      <div class="form-group"><label>Condi√ß√µes de Pagamento</label><input type="text" id="s_pagamento" placeholder="Ex: 50% entrada + 50% entrega"></div>
      <div class="form-group"><label>Status</label>
        <select id="s_status"><option value="pendente">Pendente</option><option value="aprovado">Aprovado</option><option value="reprovado">Reprovado</option></select>
      </div>
      <div class="form-group full"><label>Observa√ß√µes <span class="req">*</span></label><textarea id="s_obs" placeholder="Campo obrigat√≥rio ‚Äî registre qualquer informa√ß√£o relevante..."></textarea></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-primary" onclick="salvarOrcamento()">üíæ Salvar Or√ßamento</button>
      <button class="btn btn-secondary" onclick="limparFormSite()">‚Ü∫ Limpar</button>
    </div>
  </div>
  <div class="filter-row" id="siteFilters">
    <span class="filter-chip active" onclick="filtrarSite('todos',this)">Todos</span>
    <span class="filter-chip" onclick="filtrarSite('pendente',this)">Pendentes</span>
    <span class="filter-chip" onclick="filtrarSite('aprovado',this)">Aprovados</span>
    <span class="filter-chip" onclick="filtrarSite('reprovado',this)">Reprovados</span>
  </div>
  <div class="table-wrap">
    <div class="table-toolbar">
      <h3>Hist√≥rico de Or√ßamentos</h3>
      <div class="search-box"><input type="text" id="searchSite" placeholder="üîç Buscar..." oninput="renderOrcamentos()"></div>
      <button class="btn btn-secondary btn-sm print-hide" onclick="gerarRelatorioSites()">üìÑ Gerar PDF</button>
    </div>
    <table><thead><tr><th>N¬∫</th><th>Data</th><th>Fornecedor</th><th>Servi√ßo</th><th>Valor</th><th>Prazo</th><th>Status</th><th>A√ß√µes</th></tr></thead>
      <tbody id="tabelaOrc"><tr><td colspan="8"><div class="empty-state"><div class="icon">üìã</div><h4>Conectando...</h4></div></td></tr></tbody>
    </table>
  </div>
  <div id="compareSection" style="display:none;margin-top:30px;">
    <div class="form-card"><h3>üìä Comparativo de Propostas</h3><div id="compareContent"></div></div>
  </div>
</div>

<div id="panel-fornecedores" class="panel">
  <div class="panel-title">Gest√£o de Fornecedores</div>
  <div class="panel-sub">Cadastro e controle estrat√©gico de fornecedores homologados.</div>
  <div class="form-card">
    <h3>Cadastrar Fornecedor</h3>
    <div class="form-grid">
      <div class="form-group"><label>Nome Empresarial <span class="req">*</span></label><input type="text" id="f_nome" placeholder="Raz√£o social ou nome fantasia"></div>
      <div class="form-group"><label>Respons√°vel</label><input type="text" id="f_responsavel" placeholder="Nome do contato"></div>
      <div class="form-group"><label>Telefone</label><input type="text" id="f_telefone" placeholder="(11) 99999-9999"></div>
      <div class="form-group"><label>E-mail</label><input type="text" id="f_email" placeholder="contato@empresa.com.br"></div>
      <div class="form-group"><label>Categoria</label>
        <select id="f_categoria"><option value="Site">Site / Digital</option><option value="Material de Escrit√≥rio">Material de Escrit√≥rio</option><option value="Tecnologia">Tecnologia / TI</option><option value="Outros">Outros</option></select>
      </div>
      <div class="form-group"><label>Avalia√ß√£o</label>
        <select id="f_avaliacao"><option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excelente</option><option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Bom</option><option value="3">‚≠ê‚≠ê‚≠ê Regular</option><option value="2">‚≠ê‚≠ê Ruim</option><option value="1">‚≠ê P√©ssimo</option></select>
      </div>
      <div class="form-group full"><label>Observa√ß√µes</label><textarea id="f_obs" placeholder="Hist√≥rico, condi√ß√µes especiais, notas..."></textarea></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-primary" onclick="salvarFornecedor()">üíæ Salvar Fornecedor</button>
      <button class="btn btn-secondary" onclick="limparFormForn()">‚Ü∫ Limpar</button>
    </div>
  </div>
  <div class="filter-row" id="fornFilters">
    <span class="filter-chip active" onclick="filtrarForn('Todos',this)">Todos</span>
    <span class="filter-chip" onclick="filtrarForn('Site',this)">Site / Digital</span>
    <span class="filter-chip" onclick="filtrarForn('Material de Escrit√≥rio',this)">Mat. Escrit√≥rio</span>
    <span class="filter-chip" onclick="filtrarForn('Tecnologia',this)">Tecnologia</span>
    <span class="filter-chip" onclick="filtrarForn('Outros',this)">Outros</span>
  </div>
  <div class="suppliers-grid" id="fornGrid">
    <div class="empty-state" style="grid-column:1/-1"><div class="icon">üè¢</div><h4>Conectando...</h4></div>
  </div>
</div>

<div id="panel-compras" class="panel">
  <div class="panel-title">Compras Gimba</div>
  <div class="panel-sub">Voc√™ preenche o estoque ‚Üí envia para a chefe ‚Üí ela coloca a quantidade a comprar ‚Üí aprovado!</div>
  <div id="listasGrid" style="margin-bottom:30px;"></div>
  <div class="gimba-card">
    <h3>üì¶ Nova Lista de Compras</h3>
    <p class="gimba-subtitle">Preencha os dados abaixo, adicione os produtos e envie o link para sua chefe aprovar.</p>
    <div class="gimba-meta">
      <div class="form-group"><label>Data <span class="req">*</span></label><input type="date" id="c_data"></div>
      <div class="form-group"><label>Respons√°vel <span class="req">*</span></label><input type="text" id="c_responsavel" placeholder="Seu nome (C√°ssia)"></div>
      <div class="form-group"><label>Nome da Lista</label><input type="text" id="c_nome" placeholder="Ex: Compras de Fevereiro"></div>
      <div class="form-group full"><label>Observa√ß√£o Geral <span class="req">*</span></label><input type="text" id="c_obs" placeholder="Ex: Urgente ‚Äî precisamos antes de sexta"></div>
    </div>
    <div class="gimba-table-wrap">
      <table>
        <thead>
          <tr>
            <th>‚úì</th>
            <th>Produto</th>
            <th>Estoque Atual</th>
            <th style="background:#b8922a;">‚≠ê Qtd. a Comprar (Chefe preenche)</th>
            <th>Link Gimba</th>
            <th>Obs.</th>
            <th class="print-hide"></th>
          </tr>
        </thead>
        <tbody id="checklistBody"></tbody>
      </table>
      <div class="add-item-bar">
        <input type="text" id="ci_item" placeholder="Nome do produto">
        <input type="number" id="ci_atual" placeholder="Qtd. em estoque">
        <input type="text" id="ci_link" placeholder="Link do produto na Gimba">
        <input type="text" id="ci_obs" placeholder="Observa√ß√£o">
        <button class="btn btn-primary btn-sm" onclick="adicionarItem()">+ Add</button>
      </div>
    </div>
    <div style="background:var(--cream);border:1px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:20px;">
      <div style="padding:14px 20px;border-bottom:1px solid var(--border);"><strong style="font-size:13px;">Status da Lista:</strong></div>
      <div class="status-flow">
        <span class="status-step active" id="ss1" onclick="setStatus('C√°ssia preencheu')">üìù C√°ssia preencheu</span>
        <span class="arrow">‚Üí</span>
        <span class="status-step" id="ss2" onclick="setStatus('Aguardando Chefia')">‚è≥ Aguardando Chefia</span>
        <span class="arrow">‚Üí</span>
        <span class="status-step" id="ss3" onclick="setStatus('Aprovado pela Chefia')">‚úÖ Aprovado</span>
        <span class="arrow">‚Üí</span>
        <span class="status-step" id="ss4" onclick="setStatus('Finalizado')">üèÅ Finalizado</span>
      </div>
      <div style="padding:10px 20px;background:white;border-top:1px solid var(--border);">
        <strong style="font-size:12px;">Status atual: </strong><span id="statusAtual" class="badge badge-pending">C√°ssia preencheu</span>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-primary" onclick="salvarLista()">üíæ Salvar Lista</button>
      <button class="btn btn-teal print-hide" onclick="enviarParaChefe()">üîó Enviar Link para Chefe</button>
      <button class="btn btn-secondary print-hide" onclick="exportarPDFAtual()">üìÑ Exportar PDF</button>
      <button class="btn btn-secondary print-hide" onclick="novaLista()">üóí Nova Lista</button>
    </div>
  </div>
</div>

</main>

<div id="linkModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:1000;align-items:center;justify-content:center;padding:20px;">
  <div style="background:white;border-radius:16px;padding:40px;max-width:500px;width:100%;text-align:center;box-shadow:var(--shadow-lg);">
    <div style="font-size:48px;margin-bottom:16px;">üîó</div>
    <h3 style="font-family:'Playfair Display',serif;font-size:22px;margin-bottom:8px;">Link copiado!</h3>
    <p style="color:var(--slate);font-size:14px;margin-bottom:24px;">Mande este link para sua chefe pelo WhatsApp ou e-mail. Ela vai ver a lista e preencher a quantidade a comprar em tempo real.</p>
    <div style="background:var(--cream);border:1px solid var(--border);border-radius:8px;padding:14px;font-family:'DM Mono',monospace;font-size:12px;word-break:break-all;margin-bottom:24px;color:var(--slate);" id="linkDisplay"></div>
    <div style="background:var(--gold-pale);border:1px solid var(--gold);border-radius:10px;padding:16px;margin-bottom:24px;text-align:left;">
      <strong style="font-size:13px;color:var(--gold);">üìã Instru√ß√£o para a chefe:</strong>
      <ol style="font-size:13px;margin-top:8px;margin-left:16px;line-height:2;">
        <li>Abrir o link</li>
        <li>Ir em <strong>Compras Gimba</strong></li>
        <li>Clicar em <strong>Editar</strong> na lista</li>
        <li>Preencher a coluna dourada <strong>"Qtd. a Comprar"</strong></li>
        <li>Clicar em <strong>Salvar</strong></li>
      </ol>
    </div>
    <button class="btn btn-primary" style="width:100%;" onclick="document.getElementById('linkModal').style.display='none'">Fechar</button>
  </div>
</div>

<div id="reportModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:1000;overflow-y:auto;padding:30px;">
  <div style="max-width:820px;margin:0 auto;">
    <div class="report-preview">
      <div class="report-preview-header">
        <span style="font-weight:600;">üìÑ Relat√≥rio Formal</span>
        <div style="display:flex;gap:10px;" class="print-hide">
          <button class="btn btn-secondary btn-sm" onclick="window.print()">üñ®Ô∏è Imprimir / PDF</button>
          <button class="btn btn-danger btn-sm" onclick="document.getElementById('reportModal').style.display='none'">‚úï Fechar</button>
        </div>
      </div>
      <div class="report-body" id="reportBody"></div>
    </div>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, update, remove, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const _cfg = {
  apiKey: atob("QUl6YVN5Q19sZkJTUzJqWkJOY0UzZlZFQVBILTRuWlR5RllhV0o4"),
  authDomain: "oab-santana.firebaseapp.com",
  databaseURL: "https://oab-santana-default-rtdb.firebaseio.com",
  projectId: "oab-santana",
  storageBucket: "oab-santana.firebasestorage.app",
  messagingSenderId: "587189470292",
  appId: "1:587189470292:web:20fa9c00329b8afc5559c1"
};

const app = initializeApp(_cfg);
const db = getDatabase(app);

const S = {
  orcamentos:{}, fornecedores:{}, listas:{},
  checklistItems:[], checklistStatus:'C√°ssia preencheu',
  editingOrc:null, editingForn:null, editingLista:null,
  filtroSite:'todos', filtroForn:'Todos'
};

function setSyncStatus(type,msg){
  const bar=document.getElementById('syncBar');
  bar.className='sync-bar '+type;
  document.getElementById('syncMsg').textContent=msg;
}

onValue(ref(db,'orcamentos'),snap=>{
  S.orcamentos=snap.val()||{};renderOrcamentos();updateDash();
  setSyncStatus('ok','‚úî Conectado ‚Äî dados sincronizados em tempo real');
},err=>setSyncStatus('error','‚úó Erro: '+err.message));

onValue(ref(db,'fornecedores'),snap=>{S.fornecedores=snap.val()||{};renderFornecedores();updateDash();});
onValue(ref(db,'listas'),snap=>{S.listas=snap.val()||{};renderListasGrid();updateDash();});

function toast(msg,type='success'){
  const c=document.getElementById('toastContainer');
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  el.innerHTML=`<span>${type==='success'?'‚úÖ':type==='error'?'‚ùå':'‚ÑπÔ∏è'}</span> ${msg}`;
  c.appendChild(el);setTimeout(()=>el.remove(),4500);
}

function fmt(v){return parseFloat(v||0).toLocaleString('pt-br',{minimumFractionDigits:2,maximumFractionDigits:2});}

function badgeHtml(status){
  const map={pendente:'badge-pending',aprovado:'badge-approved',reprovado:'badge-rejected',
    'C√°ssia preencheu':'badge-pending','Aguardando Chefia':'badge-adjust',
    'Aprovado pela Chefia':'badge-approved',Finalizado:'badge-done'};
  const labels={pendente:'Pendente',aprovado:'Aprovado',reprovado:'Reprovado'};
  return `<span class="badge ${map[status]||'badge-pending'}">${labels[status]||status}</span>`;
}

function updateDash(){
  const orcs=Object.values(S.orcamentos);
  document.getElementById('statOrc').textContent=orcs.length;
  document.getElementById('statAprov').textContent=orcs.filter(o=>o.status==='aprovado').length;
  document.getElementById('statForn').textContent=Object.keys(S.fornecedores).length;
  document.getElementById('statListas').textContent=Object.keys(S.listas).length;
}

window.showPanel=(name,btn)=>{
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('panel-'+name).classList.add('active');
  btn.classList.add('active');
};

window.salvarOrcamento=async()=>{
  const num=document.getElementById('s_num').value.trim();
  const fornecedor=document.getElementById('s_fornecedor').value.trim();
  const descricao=document.getElementById('s_descricao').value.trim();
  const obs=document.getElementById('s_obs').value.trim();
  const valor=parseFloat(document.getElementById('s_valor').value);
  if(!num||!fornecedor||!descricao||!obs||isNaN(valor)){toast('Preencha todos os campos obrigat√≥rios (*).','error');return;}
  const orc={num,data:document.getElementById('s_data').value,fornecedor,
    cnpj:document.getElementById('s_cnpj').value,descricao,valor,
    prazo:document.getElementById('s_prazo').value,pagamento:document.getElementById('s_pagamento').value,
    status:document.getElementById('s_status').value,obs,criadoEm:new Date().toISOString()};
  try{
    if(S.editingOrc){await update(ref(db,'orcamentos/'+S.editingOrc),orc);S.editingOrc=null;toast('Or√ßamento atualizado! ‚úÖ');}
    else{await push(ref(db,'orcamentos'),orc);toast('Or√ßamento salvo! ‚úÖ');}
    limparFormSite();
  }catch(e){toast('Erro: '+e.message,'error');}
};

window.limparFormSite=()=>{
  ['s_num','s_fornecedor','s_cnpj','s_descricao','s_valor','s_prazo','s_pagamento','s_obs'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  document.getElementById('s_data').value=new Date().toISOString().split('T')[0];
  document.getElementById('s_status').value='pendente';S.editingOrc=null;
};

window.filtrarSite=(f,chip)=>{
  S.filtroSite=f;
  document.querySelectorAll('#siteFilters .filter-chip').forEach(c=>c.classList.remove('active'));
  chip.classList.add('active');renderOrcamentos();
};

function renderOrcamentos(){
  const search=(document.getElementById('searchSite')?.value||'').toLowerCase();
  let list=Object.entries(S.orcamentos).map(([id,o])=>({...o,id}));
  if(S.filtroSite!=='todos')list=list.filter(o=>o.status===S.filtroSite);
  if(search)list=list.filter(o=>o.fornecedor.toLowerCase().includes(search)||o.num.toLowerCase().includes(search)||o.descricao.toLowerCase().includes(search));
  const tb=document.getElementById('tabelaOrc');
  if(!list.length){tb.innerHTML=`<tr><td colspan="8"><div class="empty-state"><div class="icon">üìã</div><h4>Nenhum or√ßamento</h4><p>Preencha o formul√°rio acima.</p></div></td></tr>`;document.getElementById('compareSection').style.display='none';return;}
  tb.innerHTML=list.map(o=>`<tr>
    <td><code style="font-size:12px;">${o.num}</code></td>
    <td>${o.data?new Date(o.data+'T12:00').toLocaleDateString('pt-br'):'‚Äî'}</td>
    <td><strong>${o.fornecedor}</strong><br><span style="font-size:11px;color:var(--slate);">${o.cnpj||''}</span></td>
    <td style="max-width:180px;white-space:normal;font-size:12px;">${o.descricao}</td>
    <td><strong>R$ ${fmt(o.valor)}</strong></td>
    <td>${o.prazo||'‚Äî'}</td>
    <td>${badgeHtml(o.status)}</td>
    <td class="print-hide"><div style="display:flex;gap:4px;">
      <button class="btn btn-secondary btn-sm" onclick="editarOrc('${o.id}')">‚úèÔ∏è</button>
      <button class="btn btn-danger btn-sm" onclick="excluirOrc('${o.id}')">üóë</button>
    </div></td>
  </tr>`).join('');
  renderComparativo(list);
}

window.editarOrc=id=>{
  const o=S.orcamentos[id];if(!o)return;
  document.getElementById('s_num').value=o.num;document.getElementById('s_data').value=o.data||'';
  document.getElementById('s_fornecedor').value=o.fornecedor;document.getElementById('s_cnpj').value=o.cnpj||'';
  document.getElementById('s_descricao').value=o.descricao;document.getElementById('s_valor').value=o.valor;
  document.getElementById('s_prazo').value=o.prazo||'';document.getElementById('s_pagamento').value=o.pagamento||'';
  document.getElementById('s_status').value=o.status;document.getElementById('s_obs').value=o.obs||'';
  S.editingOrc=id;window.scrollTo({top:0,behavior:'smooth'});
  toast('Editando or√ßamento ‚Äî altere e salve.','info');
};

window.excluirOrc=async id=>{
  if(!confirm('Excluir este or√ßamento?\n\nEsta a√ß√£o n√£o pode ser desfeita.'))return;
  try{await remove(ref(db,'orcamentos/'+id));toast('Exclu√≠do.');}catch(e){toast('Erro: '+e.message,'error');}
};

function renderComparativo(list){
  const sec=document.getElementById('compareSection');
  if(list.length<2){sec.style.display='none';return;}
  sec.style.display='block';
  const sorted=[...list].sort((a,b)=>a.valor-b.valor);const w=sorted[0];
  document.getElementById('compareContent').innerHTML=`
    <table><thead><tr><th>Fornecedor</th><th>Valor</th><th>Prazo</th><th>Pagamento</th><th>Status</th></tr></thead>
    <tbody>${sorted.map(o=>`<tr class="${o.id===w.id?'winner-row':''}">
      <td>${o.fornecedor}${o.id===w.id?' üèÜ <strong>(Menor Valor)</strong>':''}</td>
      <td><strong>R$ ${fmt(o.valor)}</strong></td><td>${o.prazo||'‚Äî'}</td><td>${o.pagamento||'‚Äî'}</td><td>${badgeHtml(o.status)}</td>
    </tr>`).join('')}</tbody></table>
    <p style="margin-top:14px;font-size:13px;color:var(--slate);">‚ÑπÔ∏è Menor valor: <strong>${w.fornecedor}</strong> ‚Äî R$ ${fmt(w.valor)}${sorted[1]?`. Economia: R$ ${fmt(sorted[1].valor-w.valor)}`:''}.</p>`;
}

window.gerarRelatorioSites=()=>{
  const list=Object.values(S.orcamentos);
  if(!list.length){toast('Nenhum or√ßamento.','error');return;}
  const sorted=[...list].sort((a,b)=>a.valor-b.valor);const w=sorted[0];
  const hoje=new Date().toLocaleDateString('pt-br');
  document.getElementById('reportBody').innerHTML=`
    <div class="report-oab-header">
      <h2>ORDEM DOS ADVOGADOS DO BRASIL</h2><p>Subse√ß√£o Santana de Parna√≠ba</p>
      <p style="font-size:13px;font-weight:bold;margin-top:8px;">MAPA COMPARATIVO DE PRE√áOS</p>
      <p style="font-size:12px;color:#666;margin-top:4px;">Gerado em: ${hoje}</p>
    </div>
    <table><thead><tr><th>N¬∫</th><th>Fornecedor</th><th>Servi√ßo</th><th>Valor</th><th>Prazo</th><th>Pagamento</th><th>Status</th></tr></thead>
    <tbody>${sorted.map(o=>`<tr style="${o===w?'background:#e6fff0;':''}">
      <td>${o.num}</td><td><strong>${o.fornecedor}</strong>${o===w?' ‚úÖ':''}</td>
      <td style="font-size:12px;">${o.descricao}</td><td><strong>R$ ${fmt(o.valor)}</strong></td>
      <td>${o.prazo||'‚Äî'}</td><td style="font-size:12px;">${o.pagamento||'‚Äî'}</td><td>${o.status.toUpperCase()}</td>
    </tr>`).join('')}</tbody></table>
    <div style="margin-top:26px;padding:18px;border:1px solid #000;">
      <p><strong>PARECER T√âCNICO:</strong></p>
      <p style="margin-top:10px;font-size:13px;">A proposta da <strong>${w.fornecedor}</strong> apresentou o menor valor de <strong>R$ ${fmt(w.valor)}</strong>, sendo indicada para aprova√ß√£o.</p>
    </div>
    <div style="margin-top:60px;text-align:center;">
      <p>________________________________________________________________</p>
      <p style="font-size:13px;"><strong>RESPONS√ÅVEL PELA COTA√á√ÉO</strong></p>
      <p style="font-size:10px;margin-top:8px;color:#666;">Painel Integrado de Or√ßamentos ¬∑ OAB Santana de Parna√≠ba</p>
    </div>`;
  document.getElementById('reportModal').style.display='block';
};

window.salvarFornecedor=async()=>{
  const nome=document.getElementById('f_nome').value.trim();
  if(!nome){toast('Nome obrigat√≥rio.','error');return;}
  const forn={nome,responsavel:document.getElementById('f_responsavel').value,
    telefone:document.getElementById('f_telefone').value,email:document.getElementById('f_email').value,
    categoria:document.getElementById('f_categoria').value,avaliacao:parseInt(document.getElementById('f_avaliacao').value),
    obs:document.getElementById('f_obs').value,criadoEm:new Date().toISOString()};
  try{
    if(S.editingForn){await update(ref(db,'fornecedores/'+S.editingForn),forn);S.editingForn=null;toast('Atualizado!');}
    else{await push(ref(db,'fornecedores'),forn);toast('Fornecedor salvo!');}
    limparFormForn();
  }catch(e){toast('Erro: '+e.message,'error');}
};

window.limparFormForn=()=>{
  ['f_nome','f_responsavel','f_telefone','f_email','f_obs'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  document.getElementById('f_categoria').value='Site';document.getElementById('f_avaliacao').value='5';S.editingForn=null;
};

window.filtrarForn=(cat,chip)=>{
  S.filtroForn=cat;
  document.querySelectorAll('#fornFilters .filter-chip').forEach(c=>c.classList.remove('active'));
  chip.classList.add('active');renderFornecedores();
};

function renderFornecedores(){
  let list=Object.entries(S.fornecedores).map(([id,f])=>({...f,id}));
  if(S.filtroForn!=='Todos')list=list.filter(f=>f.categoria===S.filtroForn);
  const grid=document.getElementById('fornGrid');
  if(!list.length){grid.innerHTML=`<div class="empty-state" style="grid-column:1/-1"><div class="icon">üè¢</div><h4>Nenhum fornecedor</h4><p>Cadastre acima.</p></div>`;return;}
  grid.innerHTML=list.map(f=>`<div class="supplier-card">
    <div class="sc-top">
      <div class="supplier-avatar">${f.nome.charAt(0).toUpperCase()}</div>
      <div class="sc-actions">
        <button class="btn btn-secondary btn-sm" onclick="editarForn('${f.id}')">‚úèÔ∏è</button>
        <button class="btn btn-danger btn-sm" onclick="excluirForn('${f.id}')">üóë</button>
      </div>
    </div>
    <h4>${f.nome}</h4><div class="sc-cat">${f.categoria}</div>
    ${f.responsavel?`<div class="sc-detail">üë§ <span>${f.responsavel}</span></div>`:''}
    ${f.telefone?`<div class="sc-detail">üìû <span>${f.telefone}</span></div>`:''}
    ${f.email?`<div class="sc-detail">üìß <span>${f.email}</span></div>`:''}
    <div class="stars">${'‚≠ê'.repeat(f.avaliacao)}</div>
    ${f.obs?`<div style="margin-top:10px;font-size:12px;color:var(--slate);padding-top:10px;border-top:1px solid var(--border);">${f.obs}</div>`:''}
  </div>`).join('');
}

window.editarForn=id=>{
  const f=S.fornecedores[id];if(!f)return;
  document.getElementById('f_nome').value=f.nome;document.getElementById('f_responsavel').value=f.responsavel||'';
  document.getElementById('f_telefone').value=f.telefone||'';document.getElementById('f_email').value=f.email||'';
  document.getElementById('f_categoria').value=f.categoria;document.getElementById('f_avaliacao').value=f.avaliacao;
  document.getElementById('f_obs').value=f.obs||'';S.editingForn=id;window.scrollTo({top:0,behavior:'smooth'});toast('Editando fornecedor.','info');
};

window.excluirForn=async id=>{
  if(!confirm('Excluir este fornecedor?'))return;
  try{await remove(ref(db,'fornecedores/'+id));toast('Removido.');}catch(e){toast('Erro: '+e.message,'error');}
};

window.adicionarItem=()=>{
  const item=document.getElementById('ci_item').value.trim();
  if(!item){toast('Informe o nome do produto.','error');return;}
  S.checklistItems.push({
    id:Date.now().toString(),item,
    atual:document.getElementById('ci_atual').value,
    qtdComprar:'',
    link:document.getElementById('ci_link').value,
    obs:document.getElementById('ci_obs').value,
    checked:false
  });
  ['ci_item','ci_atual','ci_link','ci_obs'].forEach(id=>document.getElementById(id).value='');
  renderChecklist();
};

function estoqueClass(qtd){
  const n=parseInt(qtd||0);
  if(n===0)return'estoque-zero';
  if(n<=3)return'estoque-baixo';
  return'estoque-ok';
}

function renderChecklist(){
  const body=document.getElementById('checklistBody');
  if(!S.checklistItems.length){
    body.innerHTML=`<tr><td colspan="7"><div class="empty-state"><div class="icon">üì¶</div><h4>Nenhum produto ainda</h4><p>Use a barra abaixo para adicionar produtos.</p></div></td></tr>`;return;
  }
  body.innerHTML=S.checklistItems.map(r=>`<tr>
    <td style="text-align:center;"><input type="checkbox" ${r.checked?'checked':''} onchange="toggleItem('${r.id}',this.checked)"></td>
    <td><strong>${r.item}</strong></td>
    <td><span class="estoque-badge ${estoqueClass(r.atual)}">${r.atual||'0'} un.</span></td>
    <td class="qty-chefe">
      <input type="number" min="0" value="${r.qtdComprar||''}" placeholder="?" onchange="atualizarQtd('${r.id}',this.value)" title="Quantidade a comprar">
    </td>
    <td style="font-size:12px;">${r.link?`<a href="${r.link}" target="_blank" style="color:var(--teal);font-weight:600;">üîó Ver na Gimba</a>`:'‚Äî'}</td>
    <td style="font-size:12px;">${r.obs||'‚Äî'}</td>
    <td class="print-hide"><button class="btn btn-danger btn-sm" onclick="removerItem('${r.id}')">üóë</button></td>
  </tr>`).join('');
}

window.toggleItem=(id,val)=>{const item=S.checklistItems.find(r=>r.id===id);if(item)item.checked=val;renderChecklist();};
window.atualizarQtd=(id,val)=>{const item=S.checklistItems.find(r=>r.id===id);if(item)item.qtdComprar=val;};

window.removerItem=id=>{
  if(!confirm('Remover este item?'))return;
  S.checklistItems=S.checklistItems.filter(r=>r.id!==id);renderChecklist();
};

window.setStatus=s=>{
  S.checklistStatus=s;
  document.querySelectorAll('.status-step').forEach(el=>el.classList.remove('active'));
  const map={'C√°ssia preencheu':'ss1','Aguardando Chefia':'ss2','Aprovado pela Chefia':'ss3','Finalizado':'ss4'};
  if(map[s])document.getElementById(map[s]).classList.add('active');
  const bmap={'C√°ssia preencheu':'badge-pending','Aguardando Chefia':'badge-adjust','Aprovado pela Chefia':'badge-approved','Finalizado':'badge-done'};
  const el=document.getElementById('statusAtual');el.className=`badge ${bmap[s]||'badge-pending'}`;el.textContent=s;
};

window.novaLista=()=>{
  if(S.checklistItems.length>0&&!confirm('Limpar lista atual?\n\nSalve antes de continuar.'))return;
  S.checklistItems=[];S.checklistStatus='C√°ssia preencheu';S.editingLista=null;
  ['c_data','c_responsavel','c_nome','c_obs'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('c_data').value=new Date().toISOString().split('T')[0];
  setStatus('C√°ssia preencheu');renderChecklist();toast('Nova lista iniciada.','info');
};

window.salvarLista=async()=>{
  const resp=document.getElementById('c_responsavel').value.trim();
  const obs=document.getElementById('c_obs').value.trim();
  if(!resp||!obs){toast('Preencha respons√°vel e observa√ß√£o.','error');return;}
  if(!S.checklistItems.length){toast('Adicione ao menos um produto.','error');return;}
  const lista={
    data:document.getElementById('c_data').value,responsavel:resp,
    nome:document.getElementById('c_nome').value||`Lista de ${resp}`,
    obs,status:S.checklistStatus,items:S.checklistItems,
    atualizadoEm:new Date().toISOString()
  };
  try{
    if(S.editingLista){await update(ref(db,'listas/'+S.editingLista),lista);toast('Lista atualizada! ‚úÖ');}
    else{const r=await push(ref(db,'listas'),lista);S.editingLista=r.key;toast('Lista salva! ‚úÖ');}
  }catch(e){toast('Erro: '+e.message,'error');}
};

window.enviarParaChefe=async()=>{
  const resp=document.getElementById('c_responsavel').value.trim();
  const obs=document.getElementById('c_obs').value.trim();
  if(!resp||!obs){toast('Preencha respons√°vel e observa√ß√£o antes de enviar.','error');return;}
  if(!S.checklistItems.length){toast('Adicione produtos antes de enviar.','error');return;}
  await salvarLista();
  setStatus('Aguardando Chefia');
  await salvarLista();
  const url=window.location.href;
  document.getElementById('linkDisplay').textContent=url;
  navigator.clipboard.writeText(url).catch(()=>{});
  document.getElementById('linkModal').style.display='flex';
};

function renderListasGrid(){
  const el=document.getElementById('listasGrid');
  const listas=Object.entries(S.listas).map(([id,l])=>({...l,id})).sort((a,b)=>new Date(b.atualizadoEm)-new Date(a.atualizadoEm));
  if(!listas.length){el.innerHTML='';return;}
  el.innerHTML=`<h3 style="font-family:'Playfair Display',serif;font-size:18px;margin-bottom:16px;">üìÇ Listas Salvas</h3>
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin-bottom:10px;">
    ${listas.map(l=>`<div style="background:white;border:1px solid var(--border);border-radius:12px;padding:20px;box-shadow:var(--shadow);">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px;">
        <div>
          <strong style="font-size:14px;">${l.nome}</strong>
          <div style="font-size:12px;color:var(--slate);margin-top:3px;">${l.data?new Date(l.data+'T12:00').toLocaleDateString('pt-br'):''} ¬∑ ${l.responsavel}</div>
        </div>
        <button class="btn btn-danger btn-sm" onclick="excluirLista('${l.id}')">üóë</button>
      </div>
      ${badgeHtml(l.status)}
      <div style="margin-top:10px;font-size:12px;color:var(--slate);">üì¶ ${(l.items||[]).length} produto(s)</div>
      <div style="margin-top:5px;font-size:12px;color:var(--slate);font-style:italic;">${l.obs}</div>
      <div style="margin-top:14px;display:flex;gap:6px;flex-wrap:wrap;">
        <button class="btn btn-secondary btn-sm" onclick="carregarLista('${l.id}')">üìÇ Editar</button>
        <button class="btn btn-teal btn-sm" onclick="pdfLista('${l.id}')">üìÑ PDF</button>
      </div>
    </div>`).join('')}
  </div>`;
}

window.excluirLista=async id=>{
  if(!confirm('Excluir esta lista permanentemente?\n\nEsta a√ß√£o n√£o pode ser desfeita.'))return;
  try{await remove(ref(db,'listas/'+id));toast('Lista exclu√≠da.');}catch(e){toast('Erro: '+e.message,'error');}
};

window.carregarLista=id=>{
  const l=S.listas[id];if(!l)return;
  document.getElementById('c_data').value=l.data||'';
  document.getElementById('c_responsavel').value=l.responsavel||'';
  document.getElementById('c_nome').value=l.nome||'';
  document.getElementById('c_obs').value=l.obs||'';
  S.checklistItems=[...(l.items||[])];S.editingLista=id;
  setStatus(l.status||'C√°ssia preencheu');renderChecklist();
  document.querySelector('.gimba-card').scrollIntoView({behavior:'smooth'});
  toast('Lista carregada. Fa√ßa as altera√ß√µes e salve.','info');
};

window.pdfLista=id=>{const l=S.listas[id];if(!l)return;gerarPDF(l.responsavel,l.nome,l.obs,l.status,l.items||[],l.data);};

window.exportarPDFAtual=()=>{
  if(!S.checklistItems.length){toast('Nenhum produto na lista.','error');return;}
  gerarPDF(document.getElementById('c_responsavel').value||'‚Äî',
    document.getElementById('c_nome').value||'Lista de Compras',
    document.getElementById('c_obs').value||'‚Äî',
    S.checklistStatus,S.checklistItems,document.getElementById('c_data').value);
};

function gerarPDF(resp,nome,obs,status,items,data){
  const hoje=new Date().toLocaleDateString('pt-br');
  const dataFmt=data?new Date(data+'T12:00').toLocaleDateString('pt-br'):'‚Äî';
  const totalComprar=items.reduce((s,r)=>s+(parseInt(r.qtdComprar)||0),0);
  document.getElementById('reportBody').innerHTML=`
    <div class="report-oab-header">
      <h2>ORDEM DOS ADVOGADOS DO BRASIL</h2><p>Subse√ß√£o Santana de Parna√≠ba</p>
      <p style="font-size:13px;font-weight:bold;margin-top:8px;">LISTA DE COMPRAS ‚Äî GIMBA</p>
      <p style="font-size:12px;color:#666;margin-top:4px;">Data: ${dataFmt} ¬∑ Respons√°vel: ${resp} ¬∑ Gerado em: ${hoje}</p>
    </div>
    <p style="margin-bottom:4px;"><strong>Lista:</strong> ${nome}</p>
    <p style="margin-bottom:4px;"><strong>Observa√ß√£o:</strong> ${obs}</p>
    <p style="margin-bottom:20px;"><strong>Status:</strong> ${status}</p>
    <table>
      <thead><tr>
        <th>‚úì</th><th>Produto</th><th>Qtd. em Estoque</th>
        <th style="background:#b8922a;color:white;">Qtd. a Comprar</th>
        <th>Link Gimba</th><th>Obs.</th>
      </tr></thead>
      <tbody>${items.map(r=>`<tr>
        <td>${r.checked?'‚úÖ':'‚òê'}</td>
        <td><strong>${r.item}</strong></td>
        <td>${r.atual||'0'}</td>
        <td style="background:#fff9e6;font-weight:700;text-align:center;">${r.qtdComprar||'‚Äî'}</td>
        <td style="font-size:11px;word-break:break-all;">${r.link||'‚Äî'}</td>
        <td>${r.obs||'‚Äî'}</td>
      </tr>`).join('')}</tbody>
    </table>
    <p style="margin-top:14px;font-size:13px;"><strong>Total a comprar: ${totalComprar} unidades</strong></p>
    <div style="margin-top:50px;display:grid;grid-template-columns:1fr 1fr;gap:40px;text-align:center;">
      <div>
        <p>________________________________</p>
        <p style="font-size:12px;margin-top:6px;"><strong>Respons√°vel pela Solicita√ß√£o</strong></p>
        <p style="font-size:11px;color:#666;">${resp}</p>
      </div>
      <div>
        <p>________________________________</p>
        <p style="font-size:12px;margin-top:6px;"><strong>Aprova√ß√£o ‚Äî Chefia</strong></p>
        <p style="font-size:11px;color:#666;">Data: ___/___/______</p>
      </div>
    </div>
    <p style="font-size:10px;color:#666;text-align:center;margin-top:30px;">Painel Integrado de Or√ßamentos ¬∑ OAB Santana de Parna√≠ba</p>`;
  document.getElementById('reportModal').style.display='block';
}

const now=new Date();
document.getElementById('headerDate').textContent=now.toLocaleDateString('pt-br',{weekday:'short',year:'numeric',month:'long',day:'numeric'});
document.getElementById('c_data').value=now.toISOString().split('T')[0];
document.getElementById('s_data').value=now.toISOString().split('T')[0];
renderChecklist();
</script>
</body>
</html>
